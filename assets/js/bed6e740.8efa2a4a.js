"use strict";(self.webpackChunknimbly=self.webpackChunknimbly||[]).push([[9093],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return u}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(n),u=o,k=m["".concat(s,".").concat(u)]||m[u]||d[u]||r;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8215:function(e,t,n){var a=n(7294);t.Z=function(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:o},t)}},9877:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(7462),o=n(7294),r=n(2389),i=n(9548),l=n(6010),s="tabItem_LplD";function c(e){var t,n,r,c=e.lazy,p=e.block,d=e.defaultValue,m=e.values,u=e.groupId,k=e.className,h=o.Children.map(e.children,(function(e){if((0,o.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=m?m:h.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),f=(0,i.lx)(v,(function(e,t){return e.value===t.value}));if(f.length>0)throw new Error('Docusaurus error: Duplicate values "'+f.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var N=null===d?d:null!=(t=null!=d?d:null==(n=h.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(r=h[0])?void 0:r.props.value;if(null!==N&&!v.some((function(e){return e.value===N})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+N+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var g=(0,i.UB)(),w=g.tabGroupChoices,b=g.setTabGroupChoices,y=(0,o.useState)(N),C=y[0],S=y[1],x=[],j=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=u){var T=w[u];null!=T&&T!==C&&v.some((function(e){return e.value===T}))&&S(T)}var O=function(e){var t=e.currentTarget,n=x.indexOf(t),a=v[n].value;a!==C&&(j(t),S(a),null!=u&&b(u,a))},D=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=x.indexOf(e.currentTarget)+1;n=x[a]||x[0];break;case"ArrowLeft":var o=x.indexOf(e.currentTarget)-1;n=x[o]||x[x.length-1]}null==(t=n)||t.focus()};return o.createElement("div",{className:"tabs-container"},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":p},k)},v.map((function(e){var t=e.value,n=e.label,r=e.attributes;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:C===t?0:-1,"aria-selected":C===t,key:t,ref:function(e){return x.push(e)},onKeyDown:D,onFocus:O,onClick:O},r,{className:(0,l.Z)("tabs__item",s,null==r?void 0:r.className,{"tabs__item--active":C===t})}),null!=n?n:t)}))),c?(0,o.cloneElement)(h.filter((function(e){return e.props.value===C}))[0],{className:"margin-vert--md"}):o.createElement("div",{className:"margin-vert--md"},h.map((function(e,t){return(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==C})}))))}function p(e){var t=(0,r.Z)();return o.createElement(c,(0,a.Z)({key:String(t)},e))}},1803:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return p}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=(n(9877),n(8215),["components"]),l={title:"Client options",sidebar_label:"Options",sidebar_position:2,slug:"/client-options/"},s=void 0,c={unversionedId:"client-options",id:"client-options",title:"Client options",description:"IO factory options",source:"@site/docs/client-options.md",sourceDirName:".",slug:"/client-options/",permalink:"/docs/v1/client-options/",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Client options",sidebar_label:"Options",sidebar_position:2,slug:"/client-options/"},sidebar:"clientSidebar",previous:{title:"API",permalink:"/docs/v1/client-api/"}},p=[{value:"IO factory options",id:"io-factory-options",children:[{value:"<code>forceNew</code>",id:"forcenew",children:[],level:3},{value:"<code>multiplex</code>",id:"multiplex",children:[],level:3}],level:2},{value:"Low-level engine options",id:"low-level-engine-options",children:[{value:"<code>transports</code>",id:"transports",children:[],level:3},{value:"<code>upgrade</code>",id:"upgrade",children:[],level:3},{value:"<code>rememberUpgrade</code>",id:"rememberupgrade",children:[],level:3},{value:"<code>path</code>",id:"path",children:[],level:3},{value:"<code>query</code>",id:"query",children:[],level:3},{value:"<code>extraHeaders</code>",id:"extraheaders",children:[],level:3},{value:"<code>withCredentials</code>",id:"withcredentials",children:[],level:3},{value:"<code>forceBase64</code>",id:"forcebase64",children:[],level:3},{value:"<code>timestampRequests</code>",id:"timestamprequests",children:[],level:3},{value:"<code>timestampParam</code>",id:"timestampparam",children:[],level:3},{value:"<code>closeOnBeforeunload</code>",id:"closeonbeforeunload",children:[],level:3},{value:"<code>protocols</code>",id:"protocols",children:[],level:3},{value:"<code>autoUnref</code>",id:"autounref",children:[],level:3},{value:"Node.js-specific options",id:"nodejs-specific-options",children:[],level:3}],level:2},{value:"Manager options",id:"manager-options",children:[{value:"<code>reconnection</code>",id:"reconnection",children:[],level:3},{value:"<code>reconnectionAttempts</code>",id:"reconnectionattempts",children:[],level:3},{value:"<code>reconnectionDelay</code>",id:"reconnectiondelay",children:[],level:3},{value:"<code>reconnectionDelayMax</code>",id:"reconnectiondelaymax",children:[],level:3},{value:"<code>randomizationFactor</code>",id:"randomizationfactor",children:[],level:3},{value:"<code>timeout</code>",id:"timeout",children:[],level:3},{value:"<code>autoConnect</code>",id:"autoconnect",children:[],level:3},{value:"<code>parser</code>",id:"parser",children:[],level:3}],level:2},{value:"Socket options",id:"socket-options",children:[{value:"<code>auth</code>",id:"auth",children:[],level:3}],level:2}],d={toc:p};function m(e){var t=e.components,l=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"io-factory-options"},"IO factory options"),(0,r.kt)("h3",{id:"forcenew"},(0,r.kt)("inlineCode",{parentName:"h3"},"forceNew")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"false")),(0,r.kt)("p",null,"Whether to create a new Manager instance."),(0,r.kt)("p",null,"A Manager instance is in charge of the low-level connection to the server (established with HTTP long-polling or WebSocket). It handles the reconnection logic."),(0,r.kt)("p",null,"A Socket instance is the interface which is used to sends events to \u2014 and receive events from \u2014 the server. It belongs to a given ",(0,r.kt)("a",{parentName:"p",href:"categories/06-Advanced/namespaces.md"},"namespace"),"."),(0,r.kt)("p",null,"A single Manager can be attached to several Socket instances."),(0,r.kt)("p",null,"The following example will reuse the same Manager instance for the 3 Socket instances (one single WebSocket connection):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const socket = io("https://example.com"); // the main namespace\nconst productSocket = io("https://example.com/product"); // the "product" namespace\nconst orderSocket = io("https://example.com/order"); // the "order" namespace\n')),(0,r.kt)("p",null,"The following example will create 3 different Manager instances (and thus 3 distinct WebSocket connections):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const socket = io("https://example.com"); // the main namespace\nconst productSocket = io("https://example.com/product", { forceNew: true }); // the "product" namespace\nconst orderSocket = io("https://example.com/order", { forceNew: true }); // the "order" namespace\n')),(0,r.kt)("p",null,"Reusing an existing namespace will also create a new Manager each time:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const socket1 = io(); // 1st manager\nconst socket2 = io(); // 2nd manager\nconst socket3 = io("/admin"); // reuse the 1st manager\nconst socket4 = io("/admin"); // 3rd manager\n')),(0,r.kt)("h3",{id:"multiplex"},(0,r.kt)("inlineCode",{parentName:"h3"},"multiplex")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")),(0,r.kt)("p",null,"The opposite of ",(0,r.kt)("inlineCode",{parentName:"p"},"forceNew"),": whether to reuse an existing Manager instance."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const socket = io(); // 1st manager\nconst adminSocket = io("/admin", { multiplex: false }); // 2nd manager\n')),(0,r.kt)("h2",{id:"low-level-engine-options"},"Low-level engine options"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"These settings will be shared by all Socket instances attached to the same Manager."))),(0,r.kt)("h3",{id:"transports"},(0,r.kt)("inlineCode",{parentName:"h3"},"transports")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},'["polling", "websocket"]')),(0,r.kt)("p",null,"The low-level connection to the Socket.IO server can either be established with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HTTP long-polling: successive HTTP requests (",(0,r.kt)("inlineCode",{parentName:"li"},"POST")," for writing, ",(0,r.kt)("inlineCode",{parentName:"li"},"GET")," for reading)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/WebSocket"},"WebSocket"))),(0,r.kt)("p",null,"The following example disables the HTTP long-polling transport:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const socket = io("https://example.com", { transports: ["websocket"] });\n')),(0,r.kt)("p",null,"Note: in that case, sticky sessions are not required on the server side (more information ",(0,r.kt)("a",{parentName:"p",href:"/docs/v1/using-multiple-nodes/"},"here"),")."),(0,r.kt)("p",null,"By default, the HTTP long-polling connection is established first, and then an upgrade to WebSocket is attempted (explanation ",(0,r.kt)("a",{parentName:"p",href:"/docs/v1/how-it-works/#upgrade-mechanism"},"here"),"). You can use WebSocket first with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const socket = io("https://example.com", {\n  transports: ["websocket", "polling"] // use WebSocket first, if available\n});\n\nsocket.on("connect_error", () => {\n  // revert to classic upgrade\n  socket.io.opts.transports = ["polling", "websocket"];\n});\n')),(0,r.kt)("p",null,"One possible downside is that the validity of your ",(0,r.kt)("a",{parentName:"p",href:"/docs/v1/handling-cors/"},"CORS configuration")," will only be checked if the WebSocket connection fails to be established."),(0,r.kt)("h3",{id:"upgrade"},(0,r.kt)("inlineCode",{parentName:"h3"},"upgrade")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")),(0,r.kt)("p",null,"Whether the client should try to upgrade the transport from HTTP long-polling to something better."),(0,r.kt)("h3",{id:"rememberupgrade"},(0,r.kt)("inlineCode",{parentName:"h3"},"rememberUpgrade")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"false")),(0,r.kt)("p",null,"If true and if the previous WebSocket connection to the server succeeded, the connection attempt will bypass the normal upgrade process and will initially try WebSocket. A connection attempt following a transport error will use the normal upgrade process. It is recommended you turn this on only when using SSL/TLS connections, or if you know that your network does not block websockets."),(0,r.kt)("h3",{id:"path"},(0,r.kt)("inlineCode",{parentName:"h3"},"path")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"/socket.io/")),(0,r.kt)("p",null,"It is the name of the path that is captured on the server side."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The server and the client values must match (unless you are using a path-rewriting proxy in between)."))),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Client")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io("https://example.com", {\n  path: "/my-custom-path/"\n});\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { createServer } from "http";\nimport { Server } from "socket.io";\n\nconst httpServer = createServer();\nconst io = new Server(httpServer, {\n  path: "/my-custom-path/"\n});\n')),(0,r.kt)("p",null,"Please note that this is different from the path in the URI, which represents the ",(0,r.kt)("a",{parentName:"p",href:"categories/06-Advanced/namespaces.md"},"Namespace"),"."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io("https://example.com/order", {\n  path: "/my-custom-path/"\n});\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'the Socket instance is attached to the "order" Namespace'),(0,r.kt)("li",{parentName:"ul"},"the HTTP requests will look like: ",(0,r.kt)("inlineCode",{parentName:"li"},"GET https://example.com/my-custom-path/?EIO=4&transport=polling&t=ML4jUwU"))),(0,r.kt)("h3",{id:"query"},(0,r.kt)("inlineCode",{parentName:"h3"},"query")),(0,r.kt)("p",null,"Default value: -"),(0,r.kt)("p",null,"Additional query parameters (then found in ",(0,r.kt)("inlineCode",{parentName:"p"},"socket.handshake.query")," object on the server-side)."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Client")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  query: {\n    x: 42\n  }\n});\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'io.on("connection", (socket) => {\n  console.log(socket.handshake.query); // prints { x: "42", EIO: "4", transport: "polling" }\n});\n')),(0,r.kt)("p",null,"The query parameters cannot be updated for the duration of the session, so changing the ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," on the client-side will only be effective when the current session gets closed and a new one is created:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'socket.io.on("reconnect_attempt", () => {\n  socket.io.opts.query.x++;\n});\n')),(0,r.kt)("p",null,"Note: the following query parameters are reserved and can't be used in your application:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"EIO"),': the version of the protocol (currently, "4")'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"transport"),': the transport name ("polling" or "websocket")'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sid"),": the session ID"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"j"),": if the transport is polling but a JSONP response is required"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"t"),": a hashed-timestamp used for cache-busting")),(0,r.kt)("h3",{id:"extraheaders"},(0,r.kt)("inlineCode",{parentName:"h3"},"extraHeaders")),(0,r.kt)("p",null,"Default value: -"),(0,r.kt)("p",null,"Additional headers (then found in ",(0,r.kt)("inlineCode",{parentName:"p"},"socket.handshake.headers")," object on the server-side)."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Client")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  extraHeaders: {\n    "my-custom-header": "1234"\n  }\n});\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'io.on("connection", (socket) => {\n  console.log(socket.handshake.headers); // an object containing "my-custom-header": "1234"\n});\n')),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"In a browser environment, the ",(0,r.kt)("inlineCode",{parentName:"p"},"extraHeaders")," option will be ignored if you only enable the WebSocket transport, since the WebSocket API in the browser does not allow providing custom headers."),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  transports: ["websocket"],\n  extraHeaders: {\n    "my-custom-header": "1234" // ignored\n  }\n});\n')),(0,r.kt)("p",{parentName:"div"},"This will work in Node.js or in React-Native though."))),(0,r.kt)("p",null,"Documentation: ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API"},"WebSocket API")),(0,r.kt)("h3",{id:"withcredentials"},(0,r.kt)("inlineCode",{parentName:"h3"},"withCredentials")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"false")),(0,r.kt)("p",null,"Whether or not cross-site requests should made using credentials such as cookies, authorization headers or TLS client certificates. Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"withCredentials")," has no effect on same-site requests."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io("https://my-backend.com", {\n  withCredentials: true\n});\n')),(0,r.kt)("p",null,"The server needs to send the right ",(0,r.kt)("inlineCode",{parentName:"p"},"Access-Control-Allow-* ")," headers to allow the connection:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { createServer } from "http";\nimport { Server } from "socket.io";\n\nconst httpServer = createServer();\nconst io = new Server(httpServer, {\n  cors: {\n    origin: "https://my-frontend.com",\n    credentials: true\n  }\n});\n')),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You cannot use ",(0,r.kt)("inlineCode",{parentName:"p"},"origin: *")," when setting ",(0,r.kt)("inlineCode",{parentName:"p"},"withCredentials")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),". This will trigger the following error:"),(0,r.kt)("blockquote",{parentName:"div"},(0,r.kt)("i",null,"Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at \u2018.../socket.io/?EIO=4&transport=polling&t=NvQfU77\u2019. (Reason: Credential is not supported if the CORS header \u2018Access-Control-Allow-Origin\u2019 is \u2018*\u2019)")))),(0,r.kt)("p",null,"Documentation:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials"},"XMLHttpRequest.withCredentials")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/docs/v1/handling-cors/"},"Handling CORS"))),(0,r.kt)("h3",{id:"forcebase64"},(0,r.kt)("inlineCode",{parentName:"h3"},"forceBase64")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"false")),(0,r.kt)("p",null,"Whether to force base64 encoding for binary content sent over WebSocket (always enabled for HTTP long-polling)."),(0,r.kt)("h3",{id:"timestamprequests"},(0,r.kt)("inlineCode",{parentName:"h3"},"timestampRequests")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")),(0,r.kt)("p",null,"Whether to add the timestamp query param to each request (for cache busting)."),(0,r.kt)("h3",{id:"timestampparam"},(0,r.kt)("inlineCode",{parentName:"h3"},"timestampParam")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},'"t"')),(0,r.kt)("p",null,"The name of the query parameter to use as our timestamp key."),(0,r.kt)("h3",{id:"closeonbeforeunload"},(0,r.kt)("inlineCode",{parentName:"h3"},"closeOnBeforeunload")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Added in v4.1.0")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")),(0,r.kt)("p",null,"Whether to (silently) close the connection when the ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event"},(0,r.kt)("inlineCode",{parentName:"a"},"beforeunload"))," event is emitted in the browser."),(0,r.kt)("p",null,"With ",(0,r.kt)("inlineCode",{parentName:"p"},"closeOnBeforeunload")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),", a ",(0,r.kt)("inlineCode",{parentName:"p"},"disconnect")," event will be emitted by the Socket instance when the user reloads the page on Firefox (but not on Chrome or Safari)."),(0,r.kt)("p",null,"With ",(0,r.kt)("inlineCode",{parentName:"p"},"closeOnBeforeunload")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", all browsers will have the same behavior (no ",(0,r.kt)("inlineCode",{parentName:"p"},"disconnect")," event when reloading the page). But this might cause issues if you use the ",(0,r.kt)("inlineCode",{parentName:"p"},"beforeunload")," event in your application."),(0,r.kt)("h3",{id:"protocols"},(0,r.kt)("inlineCode",{parentName:"h3"},"protocols")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Added in v2.0.0")),(0,r.kt)("p",null,"Default value: -"),(0,r.kt)("p",null,"Either a single protocol string or an array of protocol strings. These strings are used to indicate sub-protocols, so that a single server can implement multiple WebSocket sub-protocols (for example, you might want one server to be able to handle different types of interactions depending on the specified protocol)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  transports: ["websocket"],\n  protocols: ["my-protocol-v1"]\n});\n')),(0,r.kt)("p",null,"Server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'io.on("connection", (socket) => {\n  const transport = socket.conn.transport;\n  console.log(transport.socket.protocol); // prints "my-protocol-v1"\n});\n')),(0,r.kt)("p",null,"References:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc6455#section-1.9"},"https://datatracker.ietf.org/doc/html/rfc6455#section-1.9")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/WebSocket"},"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/WebSocket"))),(0,r.kt)("h3",{id:"autounref"},(0,r.kt)("inlineCode",{parentName:"h3"},"autoUnref")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Added in v4.0.0")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"false")),(0,r.kt)("p",null,"With ",(0,r.kt)("inlineCode",{parentName:"p"},"autoUnref")," set to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),", the Socket.IO client will allow the program to exit if there is no other active timer/TCP socket in the event system (even if the client is connected):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  autoUnref: true\n});\n')),(0,r.kt)("p",null,"See also: ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/api/timers.html#timeoutunref"},"https://nodejs.org/api/timers.html#timeoutunref")),(0,r.kt)("h3",{id:"nodejs-specific-options"},"Node.js-specific options"),(0,r.kt)("p",null,"The following options are supported:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"agent")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"pfx")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"key")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"passphrase")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"cert")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ca")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ciphers")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"rejectUnauthorized"))),(0,r.kt)("p",null,"Please refer to the Node.js documentation:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/dist/latest/docs/api/tls.html#tls_tls_connect_options_callback"},"tls.connect(options[, callback])")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/dist/latest/docs/api/tls.html#tls_tls_createsecurecontext_options"},"tls.createSecureContext([options])"))),(0,r.kt)("p",null,"Example with a self-signed certificate:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Client")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { readFileSync } from "fs";\nimport { io } from "socket.io-client";\n\nconst socket = io("https://example.com", {\n  ca: readFileSync("./cert.pem")\n});\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { readFileSync } from "fs";\nimport { createServer } from "https";\nimport { Server } from "socket.io";\n\nconst httpServer = createServer({\n  cert: readFileSync("./cert.pem"),\n  key: readFileSync("./key.pem")\n});\nconst io = new Server(httpServer);\n')),(0,r.kt)("p",null,"Example with client-certificate authentication:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Client")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { readFileSync } from "fs";\nimport { io } from "socket.io-client";\n\nconst socket = io("https://example.com", {\n  ca: readFileSync("./server-cert.pem"),\n  cert: readFileSync("./client-cert.pem"),\n  key: readFileSync("./client-key.pem"),\n});\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { readFileSync } from "fs";\nimport { createServer } from "https";\nimport { Server } from "socket.io";\n\nconst httpServer = createServer({\n  cert: readFileSync("./server-cert.pem"),\n  key: readFileSync("./server-key.pem"),\n  requestCert: true,\n  ca: [\n    readFileSync("client-cert.pem")\n  ]\n});\nconst io = new Server(httpServer);\n')),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("inlineCode",{parentName:"p"},"rejectUnauthorized")," is a Node.js-only option, it will not bypass the security check in the browser:"),(0,r.kt)("p",{parentName:"div"},(0,r.kt)("img",{alt:"Security warning in the browser",src:n(232).Z,width:"1003",height:"581"})))),(0,r.kt)("h2",{id:"manager-options"},"Manager options"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"These settings will be shared by all Socket instances attached to the same Manager."))),(0,r.kt)("h3",{id:"reconnection"},(0,r.kt)("inlineCode",{parentName:"h3"},"reconnection")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")),(0,r.kt)("p",null,"Whether reconnection is enabled or not. If set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),", you need to manually reconnect:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  reconnection: false\n});\n\nconst tryReconnect = () => {\n  setTimeout(() => {\n    socket.io.open((err) => {\n      if (err) {\n        tryReconnect();\n      }\n    });\n  }, 2000);\n}\n\nsocket.io.on("close", tryReconnect);\n')),(0,r.kt)("h3",{id:"reconnectionattempts"},(0,r.kt)("inlineCode",{parentName:"h3"},"reconnectionAttempts")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"Infinity")),(0,r.kt)("p",null,"The number of reconnection attempts before giving up."),(0,r.kt)("h3",{id:"reconnectiondelay"},(0,r.kt)("inlineCode",{parentName:"h3"},"reconnectionDelay")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"1000")),(0,r.kt)("p",null,"The initial delay before reconnection in milliseconds (affected by the ",(0,r.kt)("a",{parentName:"p",href:"#randomizationfactor"},"randomizationFactor")," value)."),(0,r.kt)("h3",{id:"reconnectiondelaymax"},(0,r.kt)("inlineCode",{parentName:"h3"},"reconnectionDelayMax")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"5000")),(0,r.kt)("p",null,"The maximum delay between two reconnection attempts. Each attempt increases the reconnection delay by 2x."),(0,r.kt)("h3",{id:"randomizationfactor"},(0,r.kt)("inlineCode",{parentName:"h3"},"randomizationFactor")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"0.5")),(0,r.kt)("p",null,"The randomization factor used when reconnecting (so that the clients do not reconnect at the exact same time after a server crash, for example)."),(0,r.kt)("p",null,"Example with the default values:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1st reconnection attempt happens between 500 and 1500 ms (",(0,r.kt)("inlineCode",{parentName:"li"},"1000 * 2^0 * (<something between -0.5 and 1.5>)"),")"),(0,r.kt)("li",{parentName:"ul"},"2nd reconnection attempt happens between 1000 and 3000 ms (",(0,r.kt)("inlineCode",{parentName:"li"},"1000 * 2^1 * (<something between -0.5 and 1.5>)"),")"),(0,r.kt)("li",{parentName:"ul"},"3rd reconnection attempt happens between 2000 and 5000 ms (",(0,r.kt)("inlineCode",{parentName:"li"},"1000 * 2^2 * (<something between -0.5 and 1.5>)"),")"),(0,r.kt)("li",{parentName:"ul"},"next reconnection attempts happen after 5000 ms")),(0,r.kt)("h3",{id:"timeout"},(0,r.kt)("inlineCode",{parentName:"h3"},"timeout")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"20000")),(0,r.kt)("p",null,"The timeout in milliseconds for each connection attempt."),(0,r.kt)("h3",{id:"autoconnect"},(0,r.kt)("inlineCode",{parentName:"h3"},"autoConnect")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},"true")),(0,r.kt)("p",null,"Whether to automatically connect upon creation. If set to ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),", you need to manually connect:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  autoConnect: false\n});\n\nsocket.connect();\n// or\nsocket.io.open();\n')),(0,r.kt)("h3",{id:"parser"},(0,r.kt)("inlineCode",{parentName:"h3"},"parser")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Added in v2.2.0")),(0,r.kt)("p",null,"Default value: ",(0,r.kt)("inlineCode",{parentName:"p"},'require("socket.io-parser")')),(0,r.kt)("p",null,"The parser used to marshall/unmarshall packets. Please see ",(0,r.kt)("a",{parentName:"p",href:"categories/06-Advanced/custom-parser.md"},"here")," for more information."),(0,r.kt)("h2",{id:"socket-options"},"Socket options"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"These settings are specific to the given Socket instance."))),(0,r.kt)("h3",{id:"auth"},(0,r.kt)("inlineCode",{parentName:"h3"},"auth")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Added in v3.0.0")),(0,r.kt)("p",null,"Default value: -"),(0,r.kt)("p",null,"Credentials that are sent when accessing a namespace (see also ",(0,r.kt)("a",{parentName:"p",href:"/docs/v1/middlewares/#sending-credentials"},"here"),")."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Client")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { io } from "socket.io-client";\n\nconst socket = io({\n  auth: {\n    token: "abcd"\n  }\n});\n\n// or with a function\nconst socket = io({\n  auth: (cb) => {\n    cb({ token: localStorage.token })\n  }\n});\n')),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'io.on("connection", (socket) => {\n  console.log(socket.handshake.auth); // prints { token: "abcd" }\n});\n')),(0,r.kt)("p",null,"You can update the ",(0,r.kt)("inlineCode",{parentName:"p"},"auth")," map when the access to the Namespace is denied:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'socket.on("connect_error", (err) => {\n  if (err.message === "invalid credentials") {\n    socket.auth.token = "efgh";\n    socket.connect();\n  }\n});\n')),(0,r.kt)("p",null,"Or manually force the Socket instance to reconnect:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'socket.auth.token = "efgh";\nsocket.disconnect().connect();\n')))}m.isMDXComponent=!0},232:function(e,t,n){t.Z=n.p+"assets/images/self-signed-certificate-a0d2f0b33ea47a62c960fcb5a98cd534.png"}}]);